---
title: "Causal Inference Introduction: R Notebook"
output: html_notebook
author: "Jose Aveldanes"
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 



Introduction to Causality: 

This notebook introduces the fundamental concepts of causality and causal inference. We will explore the potential outcomes framework, counterfactual reasoning, and the core assumptions required to estimate causal effects. We will also work through practical examples using observational data to estimate the average treatment effect (ATE) using propensity score matching. 




Theoretical underpinnings 



```{r}
# Install necessary packages if not already installed
if (!require(MatchIt)) install.packages("MatchIt")
if (!require(dplyr)) install.packages("dplyr")
if (!require(ggplot2)) install.packages("ggplot2")

# Load libraries
library(MatchIt)
library(dplyr)
library(ggplot2)

# Load the Lalonde dataset
data("lalonde", package = "MatchIt")

# Inspect the first few rows of the data
head(lalonde)

```


Propensity Score Matching (PSM) using nearest neighbor matching. In this case, the outcome is 're78' (earnings in 1978), and 'treat' is the treatment indicator

```{r}

### Covariates are age, education, race, and previous earnings (re74 and re75)

m.out <- matchit(treat ~ age + educ + race + re74 + re75, data = lalonde, method = "nearest")

### We then get a summary of the match process ###
summary(m.out)

### Visualizing the propensity scores before and after matching ### 
plot(m.out, type = "hist")

```

Exercise! 

What do these graphs tell us? How do we interpret the distributing of the propensity scores for the raw treated, raw control, match treated, matched control? 

```{r}

```



Reminder: propensity scores represent the probability of an individaul receiving the treatment based on observed covariates (such as age, education, race, adn pre-treatment earnings)
Estimating Treatment Effect 


```{r}
#Here we make the  matched dataset
matched.data <- match.data(m.out)

# Estimate the treatment effect by regressing the outcome (re78) on the treatment indicator
model <- lm(re78 ~ treat, data = matched.data)

# Output of the model 
summary(model)

# Extract the estimated treatment effect
treatment_effect <- coef(model)["treat"]
treatment_effect

```



Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

